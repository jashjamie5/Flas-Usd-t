from web3 import Web3
import json
import os

# Connect to Ethereum node (Infura, Alchemy, or local node)
infura_url = "https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID"
w3 = Web3(Web3.HTTPProvider(infura_url))

# Check connection
if not w3.isConnected():
    print("Failed to connect to the Ethereum network")
    exit()

# ERC-20 Token Contract Address (Replace with the deployed contract address)
contract_address = "0xYourTokenContractAddress"

# ABI of your ERC-20 Token (You'll get this from Remix after deploying)
with open("erc20_abi.json", "r") as abi_file:
    token_abi = json.load(abi_file)

# Instantiate the contract
contract = w3.eth.contract(address=contract_address, abi=token_abi)

# The owner's private key (for signing transactions)
private_key = "YOUR_PRIVATE_KEY"
account = w3.eth.account.privateKeyToAccount(private_key)
my_address = account.address

# Function to check token balance
def get_balance(address):
    balance = contract.functions.balanceOf(address).call()
    print(f"Balance of {address}: {balance} GFL")
    return balance

# Function to send tokens
def send_tokens(to_address, amount):
    nonce = w3.eth.getTransactionCount(my_address)
    gas_price = w3.eth.gas_price

    transaction = contract.functions.transfer(
        to_address, amount
    ).buildTransaction({
        'chainId': 1,  # 1 for mainnet, 3 for ropsten
        'gas': 200000,
        'gasPrice': gas_price,
        'nonce': nonce
    })

    # Sign the transaction
    signed_txn = w3.eth.account.sign_transaction(transaction, private_key)
    
    # Send the transaction
    txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction)
    print(f"Transaction sent: {txn_hash.hex()}")
    return txn_hash

# Main loop for the bot
if __name__ == "__main__":
    # Replace with the address of the user or bot interaction address
    recipient_address = "0xRecipientAddress"
    amount_to_send = 100 * 10**18  # GFL tokens (assuming 18 decimals)

    # Check balance
    get_balance(my_address)

    # Send tokens
    txn_hash = send_tokens(recipient_address, amount_to_send)
    print(f"Token transfer transaction hash: {txn_hash.hex()}")
